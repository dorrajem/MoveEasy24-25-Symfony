{% extends 'base.html.twig' %}

{% block title %}Nos Trains{% endblock %}

{% block body %}
<div class="container py-5">
    <h1 class="mb-4 text-center">Liste des Trains</h1>

    {# ✅ Dropdown + Confirm Button #}
    <div class="row mb-4 justify-content-center">
        <div class="col-md-4">
            <div class="input-group">
                <select id="statut-filter" class="form-select">
                    <option value="">Tous les statuts</option>
                    <option value="En service">En service</option>
                    <option value="En maintenance">En maintenance</option>
                    <option value="Hors service">Hors service</option>
                </select>
                <button id="confirm-filter" class="btn btn-success">Filtrer</button>
            </div>
        </div>
    </div>

    {# 🔁 Filtered Results Will Appear Here #}
    <div id="train-list" class="row">
        {% include 'front/train/_train_cards.html.twig' %}
    </div>

    <div class="d-flex justify-content-center mt-4">
        {{ knp_pagination_render(trains, 'bundles/bootstrap_v5_pagination.html.twig') }}
    </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const filterBtn = document.getElementById('confirm-filter');
        const statutSelect = document.getElementById('statut-filter');
        const trainList = document.getElementById('train-list');

        filterBtn.addEventListener('click', function () {
            const selectedStatut = statutSelect.value;

            fetch(`/trains/filter?statut=${encodeURIComponent(selectedStatut)}`, {
                headers: {
                    'X-Requested-With': 'XMLHttpRequest' // not required but good practice
                }
            })
            .then(response => {
                if (!response.ok) throw new Error('Erreur de réponse');
                return response.text();
            })
            .then(html => {
                trainList.innerHTML = html;
            })
            .catch(err => {
                trainList.innerHTML = '<div class="col-12 text-danger">Erreur lors du filtrage.</div>';
                console.error(err);
            });
        });
    });
</script>
{% endblock %}


